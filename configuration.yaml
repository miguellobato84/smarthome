
# Configure a default setup of Home Assistant (frontend, api, etc)
default_config:

# Text to speech
tts:
  - platform: google_translate

group: !include groups.yaml
automation: !include automations.yaml
script: !include scripts.yaml
scene: !include scenes.yaml

sensor:
  - platform: systemmonitor
    resources:
      - type: last_boot
      
  - platform: time_date
    display_options:
      - 'time'

  - platform: template
    sensors:
      minutes_next_alarm:
        friendly_name: "Minutes until Next Alarm"
        unit_of_measurement: 'm'
        entity_id: sensor.time
        value_template: "{{((states('sensor.m2101k9ag_next_alarm')|as_timestamp|int - now()|as_timestamp|int)/60)|int}}"
        availability_template: "{{ not is_state('sensor.m2101k9ag_next_alarm','unavailable') }}"
        attribute_templates:
          time: "{{ state_attr('sensor.m2101k9ag_next_alarm','Local Time') }}"
      minutes_next_sunrise:
        friendly_name: "Minutes until Next Sunrise"
        unit_of_measurement: 'm'
        entity_id: sensor.time
        value_template: "{{((state_attr('sun.sun', 'next_rising')|as_timestamp|int - now()|as_timestamp|int)/60)|int}}"
      is_morning:
        friendly_name: "Is Morning"
        entity_id: sensor.time
        value_template: "{{ 'on' if 6 <= now()|as_timestamp|timestamp_custom('%H')|int <= 10 else 'off'  }}"
      is_pre_weekday:
        friendly_name: "Is the day before of Weekday"
        entity_id: sensor.time
        value_template: "{{ 'on' if 0 <= now()|as_timestamp|timestamp_custom('%w')|int < 5 else 'off'  }}"
      is_weekday:
        friendly_name: "Is Weekday"
        entity_id: sensor.time
        value_template: "{{ 'on' if 0 < now()|as_timestamp|timestamp_custom('%w')|int < 6 else 'off'  }}"
      extractor_uptime:
        friendly_name: "Extractor running time"
        entity_id: sensor.time
        value_template: "{{ -1 if is_state('light.extractor_on_off', 'off') else (now()|as_timestamp|int - states.light.extractor_on_off.last_changed|as_timestamp|int)/60 }}"
